### This script performs correlation of the input data with the sync word and produces the correlation output.
### It does not find the start of the symbol.

function correlate_ofdm_tx(samples)
sync_word= [0x6b,0x3c,0x87,0xf2,0x30,0x8d,0x00,0x20,0x7d,0xbf,0x1b,0x89,0x42,0x97,0xec,0x79,0x0f,0x27,0x41,0x3e,0x5e,0x17,0x9c,0x8d,0x7c,0x76,0xbe,0x26,0x07,0x39,0x46,0xcf,0x54,0x47,0x5d,0x7a,0x28,0x12,0xe8,0x2b,0x06,0x28,0x25,0x13,0x09,0x2d,0x4b,0x8b,0x14,0x0b,0xf8,0x75,0x15,0xbf,0xdb,0x85,0x62,0xc8,0xf6,0x0f,0x79,0x0f,0xc2,0xb7,0x34,0x24,0x1c,0x66,0x57,0x13,0x04,0x64,0x2f,0xee,0xc4,0x05,0x4a,0x66,0x1b,0x7f,0x47,0xbc,0xab,0xbe,0x7e,0x7b,0xfc,0xc4,0x76,0xc4,0x0a,0xb4,0x38,0x1d,0xc2,0x71,0x0a,0xfa,0x2c,0x4b];
comp = samples;
index = 1;

modulated = zeros(1,800);
for i= 1: 4 :length(sync_word)
    for k = 3 : -1 : 0
	for j = 1:8
		if(bitget(sync_word(i + k), j) == 1)
			modulated(index ) =  complex(1,0);
		else
			modulated(index ) =  complex(-1,0);
		endif
		index = index + 1;
	endfor
	endfor
endfor
freq_dom = zeros(1,1024);

freq_dom(2 : 401) = modulated(401 : end) ;
freq_dom(624: 1023) = modulated(1 : 400) ;

final = [];
for i = 1:idivide(length(comp), int32(1024), 'fix')
    s1 = comp((i-1) * 1024 + 1 : i * 1024);
    out1 = ifft(freq_dom .* conj(fft(s1)));
    final = [final out1];
endfor

figure;
plot(1:length(final), abs(final));

end
